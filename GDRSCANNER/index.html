<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙƒØ§Ø´Ù Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    padding: 20px;
    font-family: Arial, sans-serif;
    background: #050814;
    color: #f5f5f5;
    direction: rtl;
    text-align: center;
  }
  h1 { margin-bottom: 5px; }
  .subtitle { color:#9da4c0; margin-bottom:25px; font-size:14px; }
  .container {
    max-width: 950px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 20px;
  }
  .card {
    background:#0c1124;
    border-radius:16px;
    padding:20px;
    text-align:right;
    box-shadow:0 0 25px rgba(0,0,0,0.4);
  }
  .card h2 { margin:0 0 10px; }
  .card p { margin:0 0 10px; color:#9da4c0; font-size:14px; }
  input[type="text"] {
    width:100%; padding:10px;
    border-radius:10px; border:none;
    background:#151a33; color:#fff;
    margin:8px 0 12px; font-size:14px;
  }
  input[type="file"] { width:100%; margin:10px 0 15px; }
  button {
    padding:10px 20px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    background:linear-gradient(135deg,#4a8bff,#7b5cff);
    color:#fff; font-weight:bold; font-size:14px;
  }
  button:hover { opacity:0.9; }
  .result {
    margin-top:15px;
    padding:12px;
    border-radius:12px;
    background:#11182f;
    font-size:14px;
    white-space:pre-wrap;
  }
  .risk-low { border:1px solid #3dd68c; }
  .risk-medium { border:1px solid #ffb020; }
  .risk-high { border:1px solid #ff4d4d; }
  .disclaimer {
    max-width:950px;
    margin:25px auto 0;
    font-size:12px;
    color:#9da4c0;
    text-align:right;
    background:#0c1124;
    padding:12px 15px;
    border-radius:12px;
    border:1px dashed #252b46;
  }
</style>
</head>
<body>

<h1>ğŸ›¡ï¸ ÙƒØ§Ø´Ù Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„</h1>
<div class="subtitle">
  Ø£Ø¯Ø§Ø© ØªØ­Ù„ÙŠÙ„ÙŠØ© ØªØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ… Ø®Ø·ÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ù‚Ø¨Ù„ ÙØªØ­Ù‡Ø§ (Ù„ÙŠØ³Øª Ù…Ø¶Ø§Ø¯ ÙÙŠØ±ÙˆØ³Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠ).
</div>

<div class="container">
  <!-- ÙØ­Øµ Ù…ÙˆÙ‚Ø¹ -->
  <div class="card">
    <h2>ğŸ”— ÙØ­Øµ Ù…ÙˆÙ‚Ø¹ (URL Scan)</h2>
    <p>Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ù…Ø¹ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ø¹Ù† Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©.</p>
    <input type="text" id="urlInput" placeholder="Ù…Ø«Ø§Ù„: https://example.com/login">
    <button onclick="scanUrl()">ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø±Ø§Ø¨Ø·</button>
    <div id="urlResult" class="result">Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙØ­Øµ Ø¨Ø¹Ø¯.</div>
  </div>

  <!-- ÙØ­Øµ Ù…Ù„Ù -->
  <div class="card">
    <h2>ğŸ“ ÙØ­Øµ Ù…Ù„Ù (File Scan)</h2>
    <p>Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ ÙˆØ§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø­Ø¬Ù… Ø¨Ø´ÙƒÙ„ ØªÙ‚Ø¯ÙŠØ±ÙŠ (Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠÙØ±Ø³Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ±).</p>
    <input type="file" id="fileInput">
    <button onclick="scanFile()">ÙØ­Øµ Ø§Ù„Ù…Ù„Ù</button>
    <div id="fileResult" class="result">Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙØ­Øµ Ø¨Ø¹Ø¯.</div>
  </div>
</div>

<div class="disclaimer">
âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø´ÙƒÙ„ÙŠ ÙˆÙ‚ÙˆØ§Ø¹Ø¯ ØªÙ‚Ø¯ÙŠØ±ÙŠØ© ÙÙ‚Ø· (Heuristics)ØŒ ÙˆÙ„Ø§ ØªØºÙ†ÙŠ Ø¹Ù† Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø¨Ø±Ø§Ù…Ø¬ Ø­Ù…Ø§ÙŠØ©
Ø£Ùˆ Ø®Ø¯Ù…Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø«Ù„ VirusTotal. Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙƒØ·Ø¨Ù‚Ø© Ø£Ù…Ø§Ù† Ø¥Ø¶Ø§ÙÙŠØ©ØŒ ÙˆÙ„ÙŠØ³ Ù…ØµØ¯Ø±Ø§Ù‹ ÙˆØ­ÙŠØ¯Ø§Ù‹ Ù„Ù„Ø­ÙƒÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø£Ùˆ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹.
</div>

<script>
// ===== ÙØ­Øµ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ± /api/scan =====
async function scanUrl() {
  const urlInput = document.getElementById('urlInput');
  const resultBox = document.getElementById('urlResult');
  const url = urlInput.value.trim();

  if (!url) {
    resultBox.textContent = 'âš  ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø£ÙˆÙ„Ø§Ù‹.';
    resultBox.className = 'result';
    return;
  }

  resultBox.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø®Ø§Ø¯Ù… ÙˆØªØ­Ù„ÙŠÙ„Ù‡...';
  resultBox.className = 'result';

  try {
    const response = await fetch('/api/scan', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ url })
    });

    const data = await response.json();

    if (!response.ok || !data.ok) {
      resultBox.textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ' + (data.error || response.status);
      return;
    }

    let css = 'result ';
    if (data.riskLevel === 'Ù…Ù†Ø®ÙØ¶') css += 'risk-low';
    else if (data.riskLevel === 'Ù…ØªÙˆØ³Ø·') css += 'risk-medium';
    else css += 'risk-high';

    const lines = [];
    lines.push(`ğŸ” Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${data.httpInfo?.finalUrl || data.url}`);
    lines.push(`ğŸ“› Ø§Ù„Ù…Ø¶ÙŠÙ (Host): ${data.host}`);
    if (data.httpInfo?.status) lines.push(`ğŸŒ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© HTTP: ${data.httpInfo.status}`);
    if (data.httpInfo?.title) lines.push(`ğŸ“„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©: ${data.httpInfo.title}`);
    lines.push('');
    lines.push(`ğŸ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${data.riskLevel} (Ø§Ù„Ø¯Ø±Ø¬Ø©: ${data.riskScore})`);
    lines.push('');
    lines.push('ğŸ“Œ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:');
    data.reasons.forEach(r => lines.push('- ' + r));

    resultBox.className = css;
    resultBox.textContent = lines.join('\n');

  } catch (err) {
    console.error(err);
    resultBox.textContent = 'âš  ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ Vercel ØªÙ… Ø¨Ù†Ø¬Ø§Ø­.';
    resultBox.className = 'result';
  }
}


// ===== ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ =====
function scanFile() {
  const input = document.getElementById('fileInput');
  const resultBox = document.getElementById('fileResult');
  const file = input.files[0];

  if (!file) {
    resultBox.textContent = 'âš  ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹.';
    resultBox.className = 'result';
    return;
  }

  const name = file.name;
  const size = file.size;
  const sizeMB = (size / (1024 * 1024)).toFixed(2);

  const lowerName = name.toLowerCase();
  const extMatch = lowerName.match(/\.([a-z0-9]+)$/);
  const ext = extMatch ? extMatch[1] : 'Ø¨Ø¯ÙˆÙ† Ø§Ù…ØªØ¯Ø§Ø¯';

  const dangerousExt = ['exe','bat','cmd','com','scr','js','vbs','ps1','jar','apk','msi','dll','sys'];
  const maybeRiskyExt = ['zip','rar','7z','iso','img'];

  let score = 0;
  let reasons = [];

  if (dangerousExt.includes(ext)) {
    score -= 40;
    reasons.push(`ğŸš¨ Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ (${ext}) ÙŠØ¹ØªØ¨Ø± Ø®Ø·ÙŠØ±Ø§Ù‹ (Ù…Ù„Ù ØªÙ†ÙÙŠØ°ÙŠ).`);
  } else if (maybeRiskyExt.includes(ext)) {
    score -= 15;
    reasons.push(`âš  Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ (${ext}) Ù…Ù„Ù Ù…Ø¶ØºÙˆØ·ØŒ Ù‚Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ø®Ø¨ÙŠØ«Ø©.`);
  } else {
    score += 5;
    reasons.push(`âœ… Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯ (${ext}) Ù„ÙŠØ³ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©.`);
  }

  if (lowerName.match(/\.(pdf|jpg|jpeg|png|docx?|xlsx?|pptx?)\.([a-z0-9]+)$/)) {
    score -= 25;
    reasons.push('ğŸš¨ Ø§Ù„Ù…Ù„Ù ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù…ØªØ¯Ø§Ø¯ÙŠÙ† (Ù…Ø«Ù„ file.pdf.exe) ÙˆÙ‡Ø°Ø§ Ø³Ù„ÙˆÙƒ Ø®Ø¨ÙŠØ« Ø´Ø§Ø¦Ø¹.');
  }

  const badWords = ['crack','keygen','hack','patch','nulled','serial','loader'];
  badWords.forEach(w => {
    if (lowerName.includes(w)) {
      score -= 20;
      reasons.push(`âš  Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ù…Ø´Ø¨ÙˆÙ‡Ø©: "${w}".`);
    }
  });

  if (sizeMB < 0.05) {
    score -= 10;
    reasons.push('âš  Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹ØŒ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ø§Ù„Ø®Ø¨ÙŠØ«Ø© ØªÙƒÙˆÙ† ØµØºÙŠØ±Ø© Ø§Ù„Ø­Ø¬Ù….');
  } else if (sizeMB > 200) {
    score -= 5;
    reasons.push('âš  Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ØŒ Ø¥Ø°Ø§ Ù„Ù… ØªØªÙˆÙ‚Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ù… ÙÙƒÙ† Ø­Ø°Ø±Ø§Ù‹.');
  } else {
    score += 5;
    reasons.push('âœ… Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ.');
  }

  let riskLevel;
  let css = 'result ';
  if (score >= 5) {
    riskLevel = 'Ù…Ù†Ø®ÙØ¶';
    css += 'risk-low';
  } else if (score >= -20) {
    riskLevel = 'Ù…ØªÙˆØ³Ø·';
    css += 'risk-medium';
  } else {
    riskLevel = 'Ø¹Ø§Ù„ÙŠ';
    css += 'risk-high';
  }

  let info =
    `Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ${name}\n` +
    `Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯: ${ext}\n` +
    `Ø§Ù„Ø­Ø¬Ù…: ${sizeMB} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª\n\n` +
    `ğŸ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${riskLevel} (Ø§Ù„Ø¯Ø±Ø¬Ø©: ${score})\n\n` +
    'ğŸ“Œ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:\n' +
    reasons.map(r => '- ' + r).join('\n');

  resultBox.className = css;
  resultBox.textContent = info;
}
</script>

</body>
</html>
